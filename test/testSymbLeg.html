<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Test Page</title>
    <style>
        .layerTile { position: absolute; }
        
        .bucket {
            margin: 25px 15px;
        }

        .symbology-container {
            display: flex;
            align-items: center;
            margin: 5px;
        }

        .symbology-container img {
            margin: 0 10px 0 0;
        }

        .symbology-container svg {
            //padding: 1px;
            //border: 1px solid black;
            box-shadow: 0px 1px 3px 0px rgba(0, 0, 0, 0.2), 0px 1px 1px 0px rgba(0, 0, 0, 0.14), 0px 2px 1px -1px rgba(0, 0, 0, 0.12);
            margin: 0 10px 0 0;
            //box-shadow: 0px 0px 0px 3px black;
        }
    </style>
</head>
<body>
    <div id='map' style='height:10%; width: 10%;'></div>
    <div id='bucket1' class="bucket"></div>
    <div id='bucket2' class="bucket"></div>
    <div id='bucket3' class="bucket"></div>
    <div id='bucket4' class="bucket"></div>
    <div id='bucket5' class="bucket"></div>
    <div id='bucket6' class="bucket"></div>
    <div id='bucket7' class="bucket"></div>
    <div id='bucket8' class="bucket"></div>
    <div id='megabucket' class="bucket"></div>
    <p id='mess' />
    <script src='../dist/geoapi.js'></script>
    <script>
        function addImg( hostDivId, legenditemPromise ) {
            // add a check for base64 data    myimg.src = "data:image/png;base64," + icon;

            legenditemPromise.then(legenditem => {
                var mydiv = document.getElementById(hostDivId);
                
                /*var dataurl = 'data:' + legenditem.contentType + legenditem.base + ',' + legenditem.imageData;
                var myimg = new Image(32, 32);
                myimg.border = "1px";
                myimg.hspace = 20;
                myimg.vspace = 20;
                myimg.src = dataurl;*/

                myspan = document.createElement('span');
                myspan.innerHTML = legenditem.label;
                
                var container = document.createElement('div');
                container.setAttribute('class', 'symbology-container')
                container.insertAdjacentHTML('afterbegin', legenditem.svgcode);
                //container.appendChild(myimg);            
                container.appendChild(myspan);

                mydiv.appendChild(container);
                // maybe add some text?
            });
        }

        geoapi('http://js.arcgis.com/3.14/', window).then(function (api) {
            // var map = api.mapManager.Map(document.getElementById('map'), { basemap: 'topo', zoom: 6, center: [-100, 50] });

            var megaLayerUrl = 'http://ec.gc.ca/arcgis/rest/services/Basemaps/OilSandsBasemap/MapServer/';
            
            for (var i = 44; i <= 46; i ++ ) {
                getGuts(megaLayerUrl + i);
            }

            function getGuts(url) {
                var layer = new api.layer.FeatureLayer(url); 
                
                layer.on('load', function(evt) {

                    var megalegend = api.symbology.rendererToLegend(layer.renderer.toJson() , 0);
                    console.log('megalegend', megalegend);

                    megalegend.layers[0].legend.forEach(legItem => {
                        addImg('megabucket', legItem);
                    })

                });
            }

            // unique value picture markers
            var layer1 = new api.layer.FeatureLayer('http://ec.gc.ca/arcgis/rest/services/JOSM/Oilsands/MapServer/0');

            layer1.on('load', function(evt) {

                var legend1 = api.symbology.rendererToLegend(layer1.renderer.toJson() , 0);
                console.log('legend1', legend1);

                legend1.layers[0].legend.forEach(legItem => {
                    addImg('bucket1', legItem);
                })

            });


            // simple markers
            var layer2 = new api.layer.FeatureLayer('http://ec.gc.ca/arcgis/rest/services/data/73865ed2-5063-4df8-803a-8e4204307758/MapServer/0');

            layer2.on('load', function(evt) {
                var legend2 = api.symbology.rendererToLegend(layer2.renderer.toJson() , 0);
                console.log('legend2', legend2);

                legend2.layers[0].legend.forEach(legItem => {
                    addImg('bucket2', legItem);
                })

            });

            // simple fill
            var layer3 = new api.layer.FeatureLayer('http://ec.gc.ca/arcgis/rest/services/JOSM/Oilsands/MapServer/2');

            layer3.on('load', function(evt) {

                var legend3 = api.symbology.rendererToLegend(layer3.renderer.toJson() , 0);
                console.log('legend3', legend3);

                legend3.layers[0].legend.forEach(legItem => {
                    addImg('bucket3', legItem);
                })

            });

            // unique value lines
            var layer4 = new api.layer.FeatureLayer('http://ec.gc.ca/arcgis/rest/services/Basemaps/OilSandsBasemap/MapServer/32');

            layer4.on('load', function(evt) {

                var legend4 = api.symbology.rendererToLegend(layer4.renderer.toJson() , 0);
                console.log('legend4', legend4);

                legend4.layers[0].legend.forEach(legItem => {
                    addImg('bucket4', legItem);
                })

            });

            // class breaks fill
            var layer5 = new api.layer.FeatureLayer('http://section917.cloudapp.net/arcgis/rest/services/TestData/ClassBreaks/MapServer/0');


            layer5.on('load', function(evt) {

                var legend5 = api.symbology.rendererToLegend(layer5.renderer.toJson() , 0);
                console.log('legend5', legend5);

                legend5.layers[0].legend.forEach(legItem => {
                    addImg('bucket5', legItem);
                })

            });

            // coloured circles
            var layer7 = new api.layer.FeatureLayer('http://ec.gc.ca/arcgis/rest/services/CESI/CESI_AirEmissions_NOx/MapServer/0');

            layer7.on('load', function(evt) {

                var legend7 = api.symbology.rendererToLegend(layer7.renderer.toJson() , 0);
                console.log('legend7', legend7);

                legend7.layers[0].legend.forEach(legItem => {
                    addImg('bucket7', legItem);
                })

            });

            // more coloured circles
            var layer8 = new api.layer.FeatureLayer('http://ec.gc.ca/arcgis/rest/services/CESI/CESI_AirEmissions_NOx/MapServer/3');

            layer8.on('load', function(evt) {

                var legend8 = api.symbology.rendererToLegend(layer8.renderer.toJson() , 0);
                console.log('legend8', legend8);

                legend8.layers[0].legend.forEach(legItem => {
                    addImg('bucket8', legItem);
                })

            });

            // triangle test
            var renderer = {
                type: 'simple',
                label: 'i am a triangle',
                symbol: {
                    color: [200,0,0,200],
                    outline: {
                        color: [0,0,200,255],
                        style: 'esriSLSSolid',
                        type: 'esriSLS',
                        width: 1
                    },
                    size: 14,
                    style: 'esriSMSTriangle',
                    type: 'esriSMS'
                }
            };

            var legend6 = api.symbology.rendererToLegend(renderer, 0);
                console.log('legend6', legend6);

                legend6.layers[0].legend.forEach(legItem => {
                    addImg('bucket6', legItem);
                })


        });
    </script>

</body>
</html>
